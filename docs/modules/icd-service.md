# ICD 服務模組 (ICD Service)

## 模組概述
ICD 服務模組是本系統的核心組件之一，專門負責處理國際疾病分類第十版（ICD-10）的相關數據。此模組整合了臨床修訂版（ICD-10-CM）與處置編碼（ICD-10-PCS），提供精確的醫療編碼查詢、階層推論與相容性檢查功能。

## 主要功能

### 1. 醫療編碼查詢
支援多種查詢方式，讓使用者能快速找到所需的 ICD-10 編碼：
- **關鍵字搜尋**：支援透過中英文關鍵字搜尋（例如：「糖尿病」、「Diabetes」、「E11」）。
- **類型過濾**：可指定搜尋「診斷碼」（Diagnosis）或「處置碼」（Procedure）。
- **模糊比對**：能處理部分匹配的查詢請求。

### 2. 併發症推論 (Complication Inference)
利用 ICD-10 的階層結構，自動推論主要診斷可能伴隨的併發症或更細緻的子分類。
- **階層分析**：從母代碼（例如 E11）推展至子代碼（例如 E11.2 伴有腎臟併發症）。
- **臨床輔助**：協助醫療人員不錯漏潛在的相關病情記錄。

### 3. 上下文關聯分析 (Nearby Codes)
提供目標代碼在編碼列表中的前後文資訊，有助於：
- **鑑別診斷**：比較相近的病況描述。
- **嚴重度評估**：查看同一類別中不同嚴重程度的編碼。

### 4. 診斷與處置衝突檢測 (Conflict Detection)
這是本模組的高級功能，用於驗證「診斷」與「處置」之間的邏輯相容性。
- **適應症檢查**：確認該處置是否適用於該診斷。
- **禁忌症警示**：標示出醫療上不合理的組合（例如：男性診斷代碼配對子宮手術）。
- **結構化分析**：同時回傳雙方的詳細資訊以供比對。

## 技術架構
- **資料來源**：基於標準 ICD-10 Excel 資料檔（位於 `data/` 目錄）。
- **資料庫**：使用 SQLite 進行高效能的本地查詢優化。
- **初始化流程**：系統啟動時自動載入 Excel 數據並轉換為關聯式資料庫結構，確保查詢速度。

## 依賴關係
本模組為獨立基礎模組，但被以下進階服務所依賴：
- **FHIR Condition Service**：轉換 ICD 代碼為 FHIR 標準格式。
- **Clinical Guideline Service**：依據診斷代碼提供臨床指引。
- **Health Food Service**：依據診斷建議相關保健資訊。
